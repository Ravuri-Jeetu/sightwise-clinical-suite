// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  password       String?         // Hashed password
  role           String          // admin, doctor, receptionist, patient
  firstName      String?
  lastName       String?
  specialization String?         // Clinical focus for doctors
  createdAt      DateTime        @default(now())
  
  // Relationships
  patientProfile PatientProfile?
  doctorProfile  DoctorProfile?
  visitsAsDoctor ClinicalVisit[] @relation("DoctorVisits")
}

model PatientProfile {
  id               String   @id @default(cuid())
  user             User     @relation(fields: [userId], references: [id])
  userId           String   @unique
  firstName        String
  lastName         String
  email            String   @unique
  dateOfBirth      DateTime?
  gender           String?
  contactNumber    String?
  address          String?
  registrationDate DateTime @default(now())
  
  // Relationships
  clinicalVisits         ClinicalVisit[]
  medicationPrescriptions MedicationPrescription[]
}

model DoctorProfile {
  id                   String @id @default(cuid())
  user                 User   @relation(fields: [userId], references: [id])
  userId               String @unique
  medicalLicenseNumber String?
  specialization       String?
  email                String @unique
}

model ClinicalVisit {
  id                      String   @id @default(cuid())
  patient                 PatientProfile @relation(fields: [patientId], references: [id])
  patientId               String
  doctor                  User     @relation("DoctorVisits", fields: [doctorId], references: [id])
  doctorId                String
  visitDate               DateTime @default(now())
  visualAcuityRight       String?  // e.g., '20/20'
  visualAcuityLeft        String?  // e.g., '20/25'
  iopRight                Float?   // Intraocular Pressure (OD)
  iopLeft                 Float?   // Intraocular Pressure (OS)
  lensGradeRight          Int?
  lensGradeLeft           Int?
  notes                   String?
  riskCategory            String?  // Low, Moderate, High
  riskExplanationSummary  String?  // AI-generated clinical insight
}

model MedicationPrescription {
  id             String         @id @default(cuid())
  patient        PatientProfile @relation(fields: [patientId], references: [id])
  patientId      String
  medicationName String
  dosage         String
  frequency      String
  isActive       Boolean        @default(true)
  prescribedDate DateTime       @default(now())
}

model PendingAuthorization {
  id             String   @id @default(cuid())
  email          String   @unique
  role           String
  firstName      String?
  lastName       String?
  specialization String?
  createdAt      DateTime @default(now())
}
